<Window
    x:Class="ChinChessClient.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:commands="http://IceTea.Wpf.Atom.com/"
    xmlns:contracts="clr-namespace:ChinChessClient.Contracts"
    xmlns:prism="http://prismlibrary.com/"
    MinWidth="1200"
    MinHeight="640"
    prism:ViewModelLocator.AutoWireViewModel="True"
    Style="{StaticResource Window_WithoutTitleBar_ScaleUp}">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/IceTea.Wpf.Core;component/DataTemplates/HotKeyDataTemplate.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Style
                x:Key="CheckBoxForMainPage"
                BasedOn="{StaticResource CheckBox_Switch}"
                TargetType="CheckBox">
                <Setter Property="Visibility" Value="Collapsed" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding DataContext.Title, RelativeSource={RelativeSource AncestorType=TabControl}}" Value="主界面">
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <DockPanel>
        <WindowTitleBar DockPanel.Dock="Top">
            <WindowTitleBar.LeftCollection>
                <ElementCollection>
                    <Button
                        Command="{Binding GoBackCommand}"
                        Content="&#xe660;"
                        FontSize="30"
                        Style="{StaticResource Button_Icon_Theme}"
                        ToolTip="后退" />

                    <Button
                        Command="{Binding ForwardCommand}"
                        Content="&#xe65f;"
                        FontSize="30"
                        Style="{StaticResource Button_Icon_Theme}"
                        ToolTip="前进" />

                    <Popup
                        IsOpen="{Binding IsEditingSetting, Mode=TwoWay}"
                        Placement="Center"
                        PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType=Window}}">
                        <Border
                            Height="500"
                            Padding="0,10"
                            Background="{StaticResource PopupBackground}"
                            CornerRadius="20">
                            <TabControl ItemContainerStyle="{StaticResource TabItem_Transparent}" Style="{StaticResource TabControl_ScrollContent}">
                                <TabItem Header="默认背景">
                                    <ListBox SelectedIndex="0" SelectedItem="{Binding DataContext.BackImage, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=TabControl}, Mode=TwoWay}">
                                        <ListBox.ItemsSource>
                                            <x:Array Type="{x:Type contracts:ImageRecord}">
                                                <contracts:ImageRecord Uri="../Resources/Images/群山.jpeg" />
                                                <contracts:ImageRecord Uri="../Resources/Images/暮山.jpeg" />
                                                <contracts:ImageRecord Uri="../Resources/Images/山水之间.jpeg" />
                                            </x:Array>
                                        </ListBox.ItemsSource>
                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel />
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate DataType="{x:Type contracts:ImageRecord}">
                                                <Border Padding="2" BorderThickness="3">
                                                    <DockPanel>
                                                        <Image
                                                            Width="100"
                                                            Height="90"
                                                            DockPanel.Dock="Top"
                                                            Source="{Binding Uri}"
                                                            Stretch="UniformToFill" />

                                                        <TextBlock
                                                            HorizontalAlignment="Center"
                                                            DockPanel.Dock="Bottom"
                                                            Text="{Binding Name}" />
                                                    </DockPanel>
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                                                                    <Setter Property="BorderBrush" Value="White" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                </Border>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </TabItem>

                                <TabItem Header="应用快捷键">
                                    <ListBox ItemContainerStyle="{StaticResource ListBoxItem_General}" ItemsSource="{Binding DataContext.AppConfigFileHotKeyManager, RelativeSource={RelativeSource AncestorType=TabControl}}" />
                                </TabItem>

                                <TabItem Header="设置">
                                    <CheckBox
                                        HorizontalContentAlignment="Left"
                                        Content="开启吃子警告："
                                        IsChecked="{Binding DataContext.NeedWarn, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                        Style="{StaticResource CheckBoxForMainPage}" />
                                </TabItem>
                            </TabControl>
                        </Border>
                    </Popup>
                </ElementCollection>
            </WindowTitleBar.LeftCollection>
            <WindowTitleBar.RightCollection>
                <ElementCollection>
                    <Button Command="{Binding ChooseBackCommand}" Style="{StaticResource Button_Icon_Theme}" />

                    <Button Command="{x:Static commands:CustomCommands.OpenSettingCommand}" Style="{StaticResource Button_Icon_MainMenu}" />
                </ElementCollection>
            </WindowTitleBar.RightCollection>
        </WindowTitleBar>

        <Grid>
            <Grid.Background>
                <ImageBrush ImageSource="{Binding BackImage.Uri}" Stretch="UniformToFill" />
            </Grid.Background>
            <ContentControl prism:RegionManager.RegionName="ChinChessRegion" DockPanel.Dock="Bottom" />
        </Grid>
    </DockPanel>
</Window>
